# Release Notes - v0.2.0-beta.2

🔧 **Hotfix Release** - Fixes integration unload error from v0.2.0-beta.1

## What's Changed

This is a hotfix release that addresses an error discovered in v0.2.0-beta.1 where the integration would log an error during unload due to a missing `close()` method in the `Elios4YouAPI` class.

---

## 🐛 Bug Fix

### Fixed Integration Unload Error

**The Problem:**
```
Error closing API connection: 'Elios4YouAPI' object has no attribute 'close'
```

When unloading the integration (during Home Assistant shutdown, integration removal, or reload), the code attempted to call `coordinator.api.close()` but the `Elios4YouAPI` class didn't have a `close()` method. Only the internal `E4Uclient` (telnet client) had this method.

**The Solution:**
Added a `close()` method to the `Elios4YouAPI` class that properly delegates to the internal telnet client's close method.

**Code Added:**
```python
def close(self) -> None:
    """Close the telnet connection."""
    if self.E4Uclient:
        self.E4Uclient.close()
        _LOGGER.debug("Closed telnet client connection")
```

**Impact:**
- Integration now unloads cleanly without errors
- Proper resource cleanup during shutdown
- No more error messages in logs during unload

**Files Changed:** `custom_components/4noks_elios4you/api.py`

---

## 📦 Installation

### Via HACS (Recommended)
1. Go to HACS > Integrations
2. Search for "4-noks Elios4you"
3. Update to version 0.2.0-beta.2
4. Restart Home Assistant

### Manual Installation
1. Download the source code (zip) from the [GitHub release](https://github.com/alexdelprete/ha-4noks-elios4you/releases/tag/v0.2.0-beta.2)
2. Extract to `config/custom_components/4noks_elios4you/`
3. Restart Home Assistant

---

## 🧪 Testing

This hotfix addresses a specific error. Please verify:

1. **Integration Unload** ✅
   - Remove the integration via Settings > Devices & Services
   - Check logs - should see "Closed telnet client connection" debug message
   - No error messages should appear

2. **Home Assistant Restart** ✅
   - Restart Home Assistant
   - Check logs during shutdown
   - No errors should appear

3. **Integration Reload** ✅
   - Reload integration via UI
   - Verify clean reload with no errors

---

## 📝 Changes from v0.2.0-beta.1

**Modified:**
- `custom_components/4noks_elios4you/api.py` - Added `close()` method (6 lines)
- `custom_components/4noks_elios4you/manifest.json` - Version bump to 0.2.0-beta.2

**All other improvements from v0.2.0-beta.1 are included:**
- ✅ Fixed sensor availability (sensors show "unavailable" when device offline)
- ✅ Enhanced error handling with custom exceptions
- ✅ Comprehensive type hints
- ✅ 100% ruff compliance
- ✅ Code quality improvements

See [v0.2.0-beta.1 release notes](v0.2.0-beta.1.md) for complete details on those improvements.

---

## ⚠️ Breaking Changes

**None** - This is a backward-compatible hotfix.

---

## 🐛 Known Issues

None at this time.

---

## 📚 Additional Documentation

- [CHANGELOG.md](../../CHANGELOG.md) - Complete changelog
- [v0.2.0-beta.1 Release Notes](v0.2.0-beta.1.md) - Details on main beta release
- [CLAUDE.md](../../CLAUDE.md) - AI-assisted development process
- [README.md](../../README.md) - General integration documentation

---

## 🙏 Acknowledgments

Thanks to @alexdelprete for quickly identifying and reporting this issue after the v0.2.0-beta.1 release.

---

**Full Changelog**: https://github.com/alexdelprete/ha-4noks-elios4you/compare/v0.2.0-beta.1...v0.2.0-beta.2
